var ordenesSinTomar=[
    {
        cliente: 'Jose Lopez',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'portomar',
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
            }
          
        ],
    },
    {
        cliente: 'Maria Hernandez',
        ubicacion: 'colonia 21 de octubre etc',
        metodoPago: 'efectivo',
        codigo: 'WPF_214',
        fecha: '12/10/2021',
        estadoOrden: 'portomar',
        pedidos:[
            {
                empresa: 'macdonal',
                nombreProducto: 'combo familiar',
                descripcion: 'combo familiar de amburgesa y papas',
                cantidad: 1 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'pollo campero',
                nombreProducto: 'combo de pollo',
                descripcion: 'combo familiar de pollo',
                cantidad: 2 ,
                precioProducto: 20,
                isv: 0.3
                
            }
          
        ],
    },
    {
        cliente: 'Jose Lopez',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'portomar',
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
            }
          
        ],
    },
    {
        cliente: 'Jose Lopez',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'portomar',
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
            }
          
        ],
    },
    
    
];

var ordenesTomadas=[
    {
        cliente: 'Pablo Garcia',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'tomada',
        estadoEntrega: 'sinTomar',
       
        estados: [
           'tomada', 'en camino','en el origen', 'en el destino','entregada'
        ],
        
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
                
            }
          
        ],
    },
    {
        cliente: 'Maria Sanches',
        ubicacion: 'colonia 30 de mayo etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WPF_214',
        fecha: '12/10/2021',
        estadoOrden: 'tomada',
        estadoEntrega: 'sinTomar',
        estados: [
            'tomada', 'en camino','en el origen', 'en el destino','entregada'
         ],
        pedidos:[
            {
                empresa: 'macdonal',
                nombreProducto: 'combo familiar',
                descripcion: 'combo familiar de amburgesa y papas',
                cantidad: 1 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'pollo campero',
                nombreProducto: 'combo de pollo',
                descripcion: 'combo familiar de pollo',
                cantidad: 2 ,
                precioProducto: 20,
                isv: 0.3
                
            }
          
        ],
    },
    {
        cliente: 'Pablo Garcia',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'tomada',
        estadoEntrega: 'sinTomar',
       
        estados: [
           'tomada', 'en camino','en el origen', 'en el destino','entregada'
        ],
        
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
                
            }
          
        ],
    },
    {
        cliente: 'Pablo Garcia',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'tomada',
        estadoEntrega: 'sinTomar',
       
        estados: [
           'tomada', 'en camino','en el origen', 'en el destino','entregada'
        ],
        
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
                
            }
          
        ],
    },
];

var ordenesEntregadas=[
    {
        cliente: 'Julio Pineda',
        ubicacion: 'colonia kenedi etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WTF_234',
        fecha: '12/10/2021',
        estadoOrden: 'entregada',
       
        pedidos:[
            {
                empresa: 'kielsa',
                nombreProducto: 'pizza peperoni',
                descripcion: 'pizza grande de peperoni',
                cantidad: 2 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'BurberKing',
                nombreProducto: 'amburgesa triple',
                descripcion: 'amburgesa triple de queso',
                cantidad: 3 ,
                precioProducto: 15,
                isv: 0.3
                
            }
          
        ],
    },
    
    {
        cliente: 'Lucy Gomez',
        ubicacion: 'colonia 30 de mayo etc',
        metodoPago: 'tarjeta Credito',
        codigo: 'WPF_214',
        fecha: '12/10/2021',
        estadoOrden: 'entregada',
        pedidos:[
            {
                empresa: 'macdonal',
                nombreProducto: 'combo familiar',
                descripcion: 'combo familiar de amburgesa y papas',
                cantidad: 1 ,
                precioProducto: 10,
                isv: 0.3
                
            },
            {
                empresa: 'pollo campero',
                nombreProducto: 'combo de pollo',
                descripcion: 'combo familiar de pollo',
                cantidad: 2 ,
                precioProducto: 20,
                isv: 0.3
                
            }
          
        ],
    },
];

var facturas = [
    
    {
        repartidor:'',
        cliente: '',
        fehaEntrega: '',
        horaEntrega: '',
        
        isvTotal: '',
        comisionMotorista: '',
        comisionAdminidtracion: '',
        totalComision: '',
        totalPagar: '',
        pedidos:[
            {
                nombreProducto: '',
                precioProducto: '',
            }
        ]

    }
        
    
];

function registrarse(){
    console.log("registrarse");
    document.getElementById('barraNav').className='navbar navbar-light  barra3';
    document.getElementById('cuerpo').className='cuerpo-general fondo3';
    document.getElementById('contenido').style.display= "none";
    document.getElementById('contenido2').style.display= "none";
   
   
    
   
    document.getElementById('contenidoRegistrar').style.display= "block";
    document.getElementById('contenidoRegistrar2').style.display= "block";
    document.getElementById('btnRegistro').style.display= "none";
    
}
function ordenes(){
    
    let fondo=document.getElementById('cuerpo');
    fondo.className='cuerpo-general fondo2';
    let barra=document.getElementById('barraNav');
    barra.className='navbar navbar-light  barra2 barra-general';
    
    
    document.getElementById('bienvenidoMotorista').style.display= "block";
    //document.getElementById('imagenLogo').style.display= "none";
    //document.getElementById('navegacion').style.justifyContent= "space-between";
    document.getElementById('navegacion').innerHTML +=`
    <img src="img/cuenta.png"  width="70px" id="imagenCuenta" ></div>
    <button type="button" class="btn btn-secondary boton2" onclick="crearMapa();">mostrar ubicacion</button>
    <div id="mapa"></div>`;
    
    document.getElementById('contenido').style.display= "none";
    document.getElementById('contenido2').style.display= "none";
    document.getElementById('btnRegistro').style.display= "none";
   
    
}
function tomarOrden(){
    document.getElementById('barraNav').className='navbar navbar-light  barra4 barra-general'
    document.getElementById('cuerpo').className='cuerpo-general fondo4';
    console.log('tomar orden');
    document.getElementById('bienvenidoMotorista').style.display= "none";
   // document.getElementById('base').style.display= "none";
    document.getElementById('ordenesPorTomar').style.display= "block";
    ordenesSinTomar.forEach(function(sinTomar, i){
        document.getElementById('ordenesPorTomar').innerHTML += `
        <div class="col-10 mx-auto my-2 c10 row flex_container sombra2" style="text-align: left; font-size: 13px; border-radius: 20px;" onclick="mostrarDetalle(${i},'${sinTomar.estadoOrden}');" data-bs-toggle="modal" data-bs-target="#detalleModal">
        <img src="img/libro1.png" style="width: 100px;">
        <div class="info_orden3  c7 c12 tamano3 sombra3 " >
          <p><b>cliente: </b> ${sinTomar.cliente}<br><b>codigo: </b>${sinTomar.codigo}</p>
        </div>  
    </div>
    <hr style="color: #531274;"> `;
    });
}
function ordenTomada(){
    document.getElementById('cuerpo').className=' fondo5';
    barra=document.getElementById('barraNav').className='navbar navbar-light  c12 barra-general';
    console.log('ordenes tomadas');
   // document.getElementById('base').style.display= "none";
    document.getElementById('ordenesPorTomar').style.display= "none";
    document.getElementById('bienvenidoMotorista').style.display= "none";
    document.getElementById('ordenesTomadas').style.display= "block";
    ordenesTomadas.forEach(function(tomadas, i){
        document.getElementById('ordenesTomadas').innerHTML += `
        <div class="col-10 mx-auto my-4 c12 borde2 row flex_container cursor" style="text-align: left; border-radius: 20px;"  onclick="mostrarEstado(${i}, '${tomadas.estadoOrden}');" >
        <div class="info_orden3 my-2 mx-auto col-12 row" style="color: #ffffff; " >
          <div class="col-3 flex_container"><img src="img/libro2.png" style="width: 100px; position: absolute; ;left: 0px;" ></div>
            <div class="col-8 c9 c7 texto  flex_container"style="margin-left: auto; border-radius: 10px;">
              <p><b>cliente: </b> ${tomadas.cliente}
              <br><b>codigo: </b>${tomadas.codigo}</p>
            </div>
            <div class="row my-4">
                 <div  id= "mostrarEstado${i}" style="display: none;" class="flex-container2 col-12"></div>
            </div>
            
         
        </div>  
    </div>
    <hr style="color: #531274;">
 </div> `});

}

function ordenEntregada(){
    document.getElementById('cuerpo').className=' fondo6';
    barra=document.getElementById('barraNav').className='navbar navbar-light  c12 barra-general';
    console.log('ordenes entregadas');
    document.getElementById('bienvenidoMotorista').style.display= "none";
    //document.getElementById('base').style.display= "none";
    document.getElementById('ordenesPorTomar').style.display= "none";
    document.getElementById('ordenesTomadas').style.display= "none";
    document.getElementById('ordenesEntregadas').style.display= "block";

    ordenesEntregadas.forEach(function(entregadas, i){
        document.getElementById('ordenesEntregadas').innerHTML += `
        <div class="col-8 mx-auto my-2 c13 sombra4 row flex_container" style="text-align: left;" onclick="mostrarDetalle(${i},'${entregadas.estadoOrden}');" data-bs-toggle="modal" data-bs-target="#detalleModal">
        <img src="img/libro3.png" style="width: 70px;">
        <div class="  col-8 c4 c13 sombra4" >
          <p style="font-size: 12px;"><b>cliente: </b> ${entregadas.cliente}<br><b>codigo: </b>${entregadas.codigo}</p>
        </div>  
    </div>
    <hr style="color: #531274;"> `;});
}

function mostrarDetalle(indice, estado){
    console.log(indice,estado)
   let orden='';
    if (estado==='tomada') {
        orden= ordenesTomadas[indice];
        document.getElementById('modalCabecera').innerHTML =`
         <h5 class="modal-title" id="detalleModalLabel">Orden #${indice+1}</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        `;
    }
    else if (estado==='portomar') {
        orden= ordenesSinTomar[indice];
        document.getElementById('modalCabecera').innerHTML =`
         <h5 class="modal-title" id="detalleModalLabel">Orden #${indice+1}</h5>
        <button type="button " class="btn btn-secondary boton2" onclick="guardarOrden();">Tomar Orden</button>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        `;
    }
    else{
        orden= ordenesEntregadas[indice];
        document.getElementById('modalCabecera').innerHTML =`
         <h5 class="modal-title" id="detalleModalLabel">Orden #${indice+1}</h5>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        `;
    }
    console.log('mostrar detalle' ,indice);
    document.getElementById('modalFondo').style.background ='linear-gradient(to bottom left, #541274, #9a79f4)';
    let pedidos='';
    for (let i = 0; i < orden.pedidos.length; i++) {
      pedidos +=`<p>
      <b>#${i+1}</b><br>
      <b>Empresa: </b>${orden.pedidos[i].empresa}<br>
      <b>Producto: </b>${orden.pedidos[i].nombreProducto}<br>
      <b>Descripcion: </b>${orden.pedidos[i].descripcion}<br>
      <b>Cantidad: </b>${orden.pedidos[i].cantidad}<br>
      <b>precio: </b>${orden.pedidos[i].precioProducto} $</p>`;  
        
    }

    document.getElementById('modalContenido').innerHTML =`
    <div class= "tamano2 c9 mx-auto contenedor"><p>
    <b>cliente: </b>${orden.cliente}<br>
    <b>Ubicacion: </b>${orden.ubicacion}<br>
    <b>Metodo de pago: </b>${orden.metodoPago}<br>
    <b>Fecha: </b>${orden.fecha}<br></p>
    <hr>
    <b>pedidos: </b>
    <hr>
    <div>${pedidos}</div>
    </div>`;
}
function mostrarEstado(indice, estado){
   let mostrar = document.getElementById(`mostrarEstado${indice}`).style.display;
    if (mostrar==='none') {
        document.getElementById(`mostrarEstado${indice}`).style.display= 'block';
    }
    else{
        document.getElementById(`mostrarEstado${indice}`).style.display= 'none'; 
    }
    document.getElementById(`mostrarEstado${indice}`).innerHTML =``;
    document.getElementById(`mostrarEstado${indice}`).innerHTML =`
        <button type="button" class="btn btn-secondary boton  my-1 " onclick="mostrarDetalle(${indice},'${estado}');" data-bs-toggle="modal" data-bs-target="#detalleModal">Ver orden</button>
        <h6 class="c7">Estado: </h6>`;
        
    ordenesTomadas[indice].estados.forEach(function(actual,i){
        let opcion='';
        if (actual==='entregada') {
            opcion='data-bs-toggle="modal" data-bs-target="#detalleModal"';
        }
        document.getElementById(`mostrarEstado${indice}`).innerHTML +=`
        <button type="button" class="btn btn-secondary bt bt${i+1} my-1 mx-1" onclick="eliminarEstado(${indice},${i});" ${opcion}>${actual}</button>`;
    });
    
}
function eliminarEstado(indice,i){
    console.log('eliminar boton',i);
    ordenesTomadas[indice].estadoEntrega=`${ordenesTomadas[indice].estados[i]}`;
    if ( ordenesTomadas[indice].estadoEntrega==='entregada') {
        mostrarFactura(indice);
    }else{
        ordenesTomadas[indice].estados.splice(i, 1,);
    }
   
    
}

function mostrarFactura(indice) {
    console.log('mostrar factura',indice);
    document.getElementById('modalFondo').style.background ='linear-gradient(to bottom left, #541274, #9a79f4)';
    document.getElementById('modalCabecera').innerHTML =`
    <h5 class="modal-title" id="detalleModalLabel">Orden #${indice+1}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
   `;
   document.getElementById('modalPie').innerHTML=`
   <button type="button " class="btn btn-secondary boton3 " onclick="finalizarOrden(${indice});">Finalizar pedido</button>
   <button type="button " class="btn btn-secondary boton3 " onclick="borrarOrden(${indice});">orden cancelada</button>
   <button type="button" class="btn btn-secondary boton " data-bs-dismiss="modal">salir</button>
   `;
    let hoy = new Date();
    let fecha = hoy.getDate() + '-' + (hoy.getMonth()+1) + '-' + hoy.getFullYear();
    let hora = hoy.getHours()+ '-' + hoy.getMinutes() + '-' + hoy.getSeconds();
    let isvTotal=0;
    let comisionMotorista= 2;
    let comisionAdminidtracion= 1;
    let subtotal=0;
    let totalComision= comisionMotorista + comisionAdminidtracion;
    let   totalPagar=0;
    let orden = ordenesTomadas[indice];
    let detalle='';
    for (let i = 0; i < orden.pedidos.length; i++) {
        detalle += `<div class="flex_container4 tamano">
            <div style="width: max-content;">${orden.pedidos[i].cantidad}_${orden.pedidos[i].nombreProducto}</div>
            <div style="width: max-content;">${orden.pedidos[i].precioProducto} $</div>
        </div>`;
        isvTotal = isvTotal+ orden.pedidos[i].isv;
        subtotal = subtotal + (orden.pedidos[i].precioProducto )
    }
    totalPagar = subtotal + isvTotal + totalComision;
   
    document.getElementById('modalContenido').innerHTML =`
   <div class="my-2 c4 mx-auto relleno_simple2"><div class="mx-4 my-3">repartidor: Juan Rodriguez</div></div>
   <div class= "tamano2 c9 mx-auto contenedor">
   
   <p><b>cliente: </b>${orden.cliente}<br>
   <b>Metodo de pago: </b>${orden.metodoPago}<br>
   <b>Fecha: </b>${fecha} <b>hora: </b>${hora}</p>
   <hr>
   <div class="flex-container2 tamano"><div class="mx-auto" style="width: max-content;"><b>Detalle de compra</b></div></div>
   ${detalle}<hr>
   <b>ISV:</b> ${isvTotal}$
   <p>
   <b>comision motorista: </b>${comisionMotorista} $<br>
   <b>comision administracion: </b>${comisionAdminidtracion} $<br>
   <b>total comision : </b>${totalComision} $</p>
   <hr>
   <h6><b>total a pagar: </b> ${totalPagar} $</h6>
   </div>`;
}



function crearMapa() {
    var divMapa = document.getElementById('map');
    navigator.geolocation.getCurrentPosition(fn_ok, fn_mal)
    function fn_mal() {
        console.log('nos se pudo obtener tu localizacion');
    }
    function fn_ok(respuesta) {
       var lat =  respuesta.coords.latitude;
       var lon =  respuesta.coords.longitude;
       
       console.log("longitud"+lon+" latitude "+lat);

        var mapa = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([lon, lat]),
          zoom: 15,
          
        }),
        
        
      });
      
      let marcador = new ol.Feature({
        geometry: new ol.geom.Point(
            ol.proj.fromLonLat([lon, lat])// En dónde se va a ubicar
        ),
    });
    
    // Agregamos icono
    marcador.setStyle(new ol.style.Style({
        image: new ol.style.Icon({
            src: "img/marcador.png",
        })
    }));
    
    // marcadores debe ser un arreglo
    const marcadores = []; // Arreglo para que se puedan agregar otros más tarde
    
    marcadores.push(marcador);// Agregamos el marcador al arreglo
    
    let capa = new ol.layer.Vector({
        source: new ol.source.Vector({
            features: marcadores, // A la capa le ponemos los marcadores
        }),
    });
    // Y agregamos la capa al mapa
    mapa.addLayer(capa);
       
    };
    
    
}